<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pro Calendar</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
body{transition:.3s}
.dark body{background:#0f172a;color:white}
.day{box-shadow:0 0 6px rgba(0,0,0,.1)}
.dark .day{background:#1e293b}
.badge{height:7px;width:100%;border-radius:6px;margin-top:auto}
#modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
#modal .box{width:350px}
.calendar{display:grid;gap:6px;margin-top:20px}
.monthGrid{grid-template-columns:repeat(7,1fr)}
.yearGrid{grid-template-columns:repeat(3,1fr)}
@media(max-width:720px){.calendar.monthGrid{grid-template-columns:repeat(4,1fr)}.yearGrid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:480px){.calendar.monthGrid{grid-template-columns:repeat(2,1fr)}.yearGrid{grid-template-columns:1fr}}
</style>
</head>

<body class="bg-gray-100 text-gray-800 dark:bg-slate-900 dark:text-white">
<div class="max-w-6xl mx-auto p-4">

<header class="flex justify-between items-center flex-wrap gap-3">
  <h2 id="title" class="text-2xl font-bold"></h2>

  <div class="flex gap-2 flex-wrap">
    <button onclick="prev()" class="px-3 py-2 rounded bg-gray-200 dark:bg-slate-700">Prev</button>
    <button onclick="next()" class="px-3 py-2 rounded bg-gray-200 dark:bg-slate-700">Next</button>

    <button onclick="setView('year')" class="px-3 py-2 rounded bg-blue-500 text-white">Year</button>
    <button onclick="setView('month')" class="px-3 py-2 rounded bg-blue-500 text-white">Month</button>
    <button onclick="setView('week')" class="px-3 py-2 rounded bg-blue-500 text-white">Week</button>

    <button onclick="toggleDark()" class="px-3 py-2 rounded bg-gray-800 text-white">Dark</button>
  </div>
</header>

<!-- SEARCH & FILTER -->
<div class="mt-3 flex gap-2 flex-wrap">
  <input id="search" placeholder="Search..." oninput="renderList()" class="p-2 rounded border w-44 dark:bg-slate-800">
  <select id="filterCat" onchange="renderList()" class="p-2 rounded border dark:bg-slate-800">
    <option value="">All Categories</option>
    <option>Work</option>
    <option>Personal</option>
    <option>Study</option>
    <option>Other</option>
  </select>
  <select id="filterRepeat" onchange="renderList()" class="p-2 rounded border dark:bg-slate-800">
    <option value="">Repeat: All</option>
    <option value="none">None</option>
    <option value="weekly">Weekly</option>
    <option value="monthly">Monthly</option>
    <option value="yearly">Yearly</option>
  </select>
</div>

<!-- CALENDAR (Swipe Area) -->
<div id="calendar" class="calendar bg-transparent" 
     ontouchstart="touchStart(event)" 
     ontouchend="touchEnd(event)">
</div>

<h3 class="mt-4 text-xl font-semibold">Reminders</h3>
<div id="list" class="mt-2"></div>
</div>

<!-- MODAL -->
<div id="modal" class="flex">
 <div class="box bg-white dark:bg-slate-800 p-4 rounded-xl">
  <h3 id="modalTitle" class="text-lg font-bold mb-2">Add Reminder</h3>

  <input id="titleInput" placeholder="Title" class="p-2 rounded border w-full dark:bg-slate-700">
  <input id="time" type="time" class="p-2 rounded border w-full dark:bg-slate-700 mt-2">
  <input id="tags" placeholder="Tags" class="p-2 rounded border w-full dark:bg-slate-700 mt-2">

  <select id="category" class="p-2 rounded border w-full dark:bg-slate-700 mt-2">
    <option>Work</option>
    <option>Personal</option>
    <option>Study</option>
    <option>Other</option>
  </select>

  <label class="mt-2 block">Repeat</label>
  <select id="repeat" class="p-2 rounded border w-full dark:bg-slate-700">
    <option value="none">None</option>
    <option value="weekly">Weekly</option>
    <option value="monthly">Monthly</option>
    <option value="yearly">Yearly</option>
  </select>

  <label class="mt-2 block">Color</label>
  <input id="color" type="color" class="w-full">

  <div class="flex gap-2 mt-3">
    <button onclick="save()" class="px-4 py-2 bg-blue-500 text-white rounded">Save</button>
    <button onclick="closeModal()" class="px-4 py-2 bg-gray-400 rounded">Cancel</button>
  </div>
 </div>
</div>

<script>
let date=new Date();
let view="month";
let selectedDay=null;
let editId=null;
let reminders=JSON.parse(localStorage.getItem("rem"))||[];

function saveData(){localStorage.setItem("rem",JSON.stringify(reminders));}
function setView(v){view=v;renderCalendar();}

function sameDay(a,b){return a.getFullYear()==b.getFullYear()&&a.getMonth()==b.getMonth()&&a.getDate()==b.getDate();}

function matchesRepeat(r,day){
 let d=new Date(r.date);
 if(r.repeat=="weekly")return d.getDay()==day.getDay();
 if(r.repeat=="monthly")return d.getDate()==day.getDate();
 if(r.repeat=="yearly")return d.getDate()==day.getDate()&&d.getMonth()==day.getMonth();
 return false;
}

function renderCalendar(){
 let year=date.getFullYear();
 let month=date.getMonth();
 let cal=document.getElementById("calendar");
 cal.innerHTML="";

 document.getElementById("title").innerText=
 view=="year" ? `${year} - Year View`
 : view=="week" ? "Week View"
 : date.toLocaleString("default",{month:"long"})+" "+year;

 if(view=="year"){
  cal.className="calendar yearGrid";
  for(let m=0;m<12;m++){
   let box=document.createElement("div");
   box.className="bg-white dark:bg-slate-800 p-2 rounded-xl";
   box.innerHTML=`<div class="text-center font-bold mb-1">
     ${new Date(year,m,1).toLocaleString("default",{month:"long"})}
   </div>
   <div class="calendar monthGrid" id="m${m}"></div>`;
   cal.appendChild(box);

   let first=new Date(year,m,1).getDay();
   let days=new Date(year,m+1,0).getDate();
   let cont=document.getElementById("m"+m);

   for(let i=0;i<first;i++)cont.appendChild(document.createElement("div"));
   for(let d=1;d<=days;d++)buildDay(year,m,d,cont);
  }
 }

 if(view=="month"){
  cal.className="calendar monthGrid";
  let first=new Date(year,month,1).getDay();
  let days=new Date(year,month+1,0).getDate();
  for(let i=0;i<first;i++)cal.appendChild(document.createElement("div"));
  for(let d=1;d<=days;d++)buildDay(year,month,d,cal);
 }

 if(view=="week"){
  cal.className="calendar monthGrid";
  let today=new Date(date);
  let start=new Date(today);start.setDate(today.getDate()-today.getDay());
  for(let i=0;i<7;i++){
    let d=new Date(start);d.setDate(start.getDate()+i);
    buildDay(d.getFullYear(),d.getMonth(),d.getDate(),cal);
  }
 }

 renderList();
}

function buildDay(year,month,d,parent){
 let div=document.createElement("div");
 div.className="day bg-white dark:bg-slate-700 rounded p-2 flex flex-col cursor-pointer";
 let dateObj=new Date(year,month,d);
 let full=`${year}-${month+1}-${d}`;
 div.innerHTML=`<span class="text-xs opacity-70">${d}</span>`;
 let dayRem=reminders.filter(r=>r.date===full||matchesRepeat(r,dateObj));
 if(dayRem.length){
  let b=document.createElement("div");
  b.className="badge";
  b.style.background=dayRem[0].color;
  div.appendChild(b);
 }
 div.onclick=()=>openModal(full);
 parent.appendChild(div);
}

// MODAL
function openModal(day){
 selectedDay=day;
 editId=null;
 modalTitle.innerText="Add Reminder";
 titleInput.value="";time.value="";tags.value="";
 color.value="#ff0000";repeat.value="none";
 document.getElementById("modal").style.display="flex";
}
function closeModal(){document.getElementById("modal").style.display="none";}

function save(){
 let r={
  date:selectedDay,title:titleInput.value,time:time.value,
  tags:tags.value.split(",").map(t=>t.trim()).filter(x=>x),
  category:category.value,color:color.value,repeat:repeat.value
 };
 if(editId!=null)reminders[editId]=r;else reminders.push(r);
 saveData();closeModal();renderCalendar();
}

function edit(i){
 let r=reminders[i];
 editId=i;selectedDay=r.date;
 modalTitle.innerText="Edit Reminder";
 titleInput.value=r.title;
 time.value=r.time;
 tags.value=r.tags.join(",");
 category.value=r.category;
 color.value=r.color;
 repeat.value=r.repeat;
 modal.style.display="flex";
}
function del(i){reminders.splice(i,1);saveData();renderCalendar();}

// Navigation
function prev(){view=="year"?date.setFullYear(date.getFullYear()-1):view=="week"?date.setDate(date.getDate()-7):date.setMonth(date.getMonth()-1);renderCalendar();}
function next(){view=="year"?date.setFullYear(date.getFullYear()+1):view=="week"?date.setDate(date.getDate()+7):date.setMonth(date.getMonth()+1);renderCalendar();}

// Dark
function toggleDark(){document.documentElement.classList.toggle("dark");}

// Search + Filter
function renderList(){
 let box=document.getElementById("list");
 box.innerHTML="";
 let q=search.value.toLowerCase();
 let cat=filterCat.value;
 let rep=filterRepeat.value;

 reminders.filter(r=>
  (!q||r.title.toLowerCase().includes(q)||r.tags.join("").toLowerCase().includes(q))
  &&(!cat||r.category==cat)
  &&(!rep||r.repeat==rep)
 ).forEach((r,i)=>{
  let div=document.createElement("div");
  div.className="p-3 rounded mb-2 text-white";
  div.style.background=r.color;
  div.innerHTML=`<b>${r.title}</b> - ${r.time} [${r.category}] (${r.repeat})
   ${r.tags.map(t=>`<span class='px-2 py-1 bg-black rounded text-xs ml-2'>${t}</span>`).join("")}
   <br>
   <button onclick="edit(${i})" class="px-2 py-1 bg-white text-black rounded mt-1">Edit</button>
   <button onclick="del(${i})" class="px-2 py-1 bg-black rounded mt-1">Delete</button>`;
  box.appendChild(div);
 });
}

/* SWIPE */
let startX=0;
function touchStart(e){startX=e.changedTouches[0].screenX;}
function touchEnd(e){
 let diff=e.changedTouches[0].screenX-startX;
 if(diff>80) prev();
 if(diff<-80) next();
}

renderCalendar();
</script>

</body>
</html>
